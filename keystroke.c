#define WINVER 0x0500
#include <windows.h>
#include <stdlib.h>
#include <string.h>
#include <stdio.h>

unsigned char ascii_to_ebc_table(unsigned char ascii);
unsigned char ascii_to_vk_table(unsigned char ascii);
unsigned char ascii_to_vk_shift_table(unsigned char ascii);
int main()
{
    INPUT ip;
	int vk = 0;
	HKL kbl = GetKeyboardLayout(0);
	char mK;
	int press_shift = 0;
    FILE* demo;

	demo = fopen("transfer.txt", "r");
	Sleep(5000);
    while (1) {
        mK = fgetc(demo);

        if (feof(demo))
            break;

		ip.type = INPUT_KEYBOARD;
		ip.ki.wScan = 0;
		ip.ki.time = 0;
		ip.ki.dwExtraInfo = 0;
		vk = ascii_to_vk_table(mK);

		if(vk==0){
			press_shift = 1;
			vk = ascii_to_vk_shift_table(mK);
		}
		if(vk==0) continue;

		if(press_shift==1){
			ip.ki.wVk = VK_SHIFT;
			ip.ki.dwFlags = 0;
			Sleep(1);
			SendInput(1, &ip, sizeof(INPUT));
		}

        ip.ki.wVk = vk;
        ip.ki.dwFlags = 0;
		Sleep(1);
        SendInput(1, &ip, sizeof(INPUT));

        ip.ki.dwFlags = KEYEVENTF_KEYUP;
		Sleep(1);
        SendInput(1, &ip, sizeof(INPUT));

		if(press_shift==1){
			ip.ki.wVk = VK_SHIFT;
			ip.ki.dwFlags = KEYEVENTF_KEYUP;
			Sleep(1);
			SendInput(1, &ip, sizeof(INPUT));
			press_shift = 0;
		}
    }

    fclose(demo);

    return 0;
}

unsigned char ascii_to_vk_shift_table(unsigned char ascii)
{
	unsigned char vk;
	static char tt[256];

tt[')'] =	0x30	;
tt['('] =	0x39	;
tt['&'] =	0x37	;
tt['^'] =	0x36	;
tt['%'] =	0x35	;
tt['$'] =	0x34	;
tt['#'] =	0x33	;
tt['@'] =	0x32	;
tt['!'] =	0x31	;
tt['~'] =	0xC0	;
tt['A'] =	0x41	;
tt['B'] =	0x42	;
tt['C'] =	0x43	;
tt['D'] =	0x44	;
tt['E'] =	0x45	;
tt['F'] =	0x46	;
tt['G'] =	0x47	;
tt['H'] =	0x48	;
tt['I'] =	0x49	;
tt['J'] =	0x4A	;
tt['K'] =	0x4B	;
tt['L'] =	0x4C	;
tt['M'] =	0x4D	;
tt['N'] =	0x4E	;
tt['O'] =	0x4F	;
tt['P'] =	0x50	;
tt['Q'] =	0x51	;
tt['R'] =	0x52	;
tt['S'] =	0x53	;
tt['T'] =	0x54	;
tt['U'] =	0x55	;
tt['V'] =	0x56	;
tt['W'] =	0x57	;
tt['X'] =	0x58	;
tt['Y'] =	0x59	;
tt['Z'] =	0x5A	;
tt['\"'] =	0xDE	;
tt['?'] =	0x6F	;
tt['<'] =	0xBC	;
tt['>'] =	0xBE	;
tt[':'] =	0xBA	;
tt['|'] =	0xDC	;

	vk=tt[ascii];
	return vk;
}

unsigned char ascii_to_vk_table(unsigned char ascii)
{
	unsigned char vk;
	static char tt[256];

tt['\n'] =	0x0D	;
tt['\r'] =	0x0D	;
tt['`'] =	0xC0	;
tt['0'] =	0x30	;
tt['1'] =	0x31	;
tt['2'] =	0x32	;
tt['3'] =	0x33	;
tt['4'] =	0x34	;
tt['5'] =	0x35	;
tt['6'] =	0x36	;
tt['7'] =	0x37	;
tt['8'] =	0x38	;
tt['9'] =	0x39	;
tt['a'] =	0x41	;
tt['b'] =	0x42	;
tt['c'] =	0x43	;
tt['d'] =	0x44	;
tt['e'] =	0x45	;
tt['f'] =	0x46	;
tt['g'] =	0x47	;
tt['h'] =	0x48	;
tt['i'] =	0x49	;
tt['j'] =	0x4A	;
tt['k'] =	0x4B	;
tt['l'] =	0x4C	;
tt['m'] =	0x4D	;
tt['n'] =	0x4E	;
tt['o'] =	0x4F	;
tt['p'] =	0x50	;
tt['q'] =	0x51	;
tt['r'] =	0x52	;
tt['s'] =	0x53	;
tt['t'] =	0x54	;
tt['u'] =	0x55	;
tt['v'] =	0x56	;
tt['w'] =	0x57	;
tt['x'] =	0x58	;
tt['y'] =	0x59	;
tt['z'] =	0x5A	;
tt['*'] =	0x6A	;
tt['+'] =	0x6B	;
tt['-'] =	0x6D	;
tt[' '] =	0x20	;
tt['\\'] =	0xDC	;
tt[']'] =	0xDD	;
tt['['] =	0xDB	;
tt['\''] =	0xDE	;
tt['='] =	0xBB	;
tt['/'] =	0x6F	;
tt[','] =	0xBC	;
tt['.'] =	0xBE	;
tt[';'] =	0xBA	;

	vk=tt[ascii];
	return vk;
}

unsigned char ascii_to_ebc_table(unsigned char ascii)
{
	unsigned char ebcd;
	static char tt[256]=
	{
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*         	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*         	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*         	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*         	*/
	0x40,0x4F,0x7F,0x7B,0x5B,0x6C,0x50,0x7D,	/*  !"#$%&'*/
	0x4D,0x5D,0x5C,0x4E,0x6B,0x60,0x4B,0x61,	/* ()*+,-./	*/
	0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,	/* 01234567	*/
	0xF8,0xF9,0x7A,0x5E,0x4C,0x7E,0x6E,0x6F,	/* 89:;<=>?	*/
	0x7C,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,	/* @ABCDEFG	*/
	0xC8,0xC9,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,	/* HIJKLMNO	*/
	0xD7,0xD8,0xD9,0xE2,0xE3,0xE4,0xE5,0xE6,	/* PQRSTUVW	*/
	0xE7,0xE8,0xE9,0x4A,0xE0,0x5A,0x5F,0x6D,	/* XYZ[\]^_	*/
	0x79,0x81,0x82,0x83,0x84,0x85,0x86,0x87,	/* `abcdefg	*/
	0x88,0x89,0x91,0x92,0x93,0x94,0x95,0x96,	/* hijklmno	*/
	0x97,0x98,0x99,0xA2,0xA3,0xA4,0xA5,0xA6,	/* pqrstuvw	*/
	0xA7,0xA8,0xA9,0xC0,0x6A,0xD0,0xA1,0x40,	/* xyz{|}~ 	*/
	0xB9,0xBA,0xED,0xBF,0xBC,0xBD,0xEC,0xFA,	/*          */
	0xCB,0xCC,0xCD,0xCE,0xCF,0xDA,0xDB,0xDC,	/*         	*/
	0xDE,0xDF,0xEA,0xEB,0xBE,0xCA,0xBB,0xFE,	/*		    */
	0xFB,0xFD,0x7d,0xEF,0xEE,0xFC,0xB8,0xDD,	/*		    */
	0x77,0x78,0xAF,0x8D,0x8A,0x8B,0xAE,0xB2,	/*		    */
	0x8F,0x90,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,	/*		    */
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*	       	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*	       	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*	       	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*	       	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*	       	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*	       	*/
	0xAA,0xAB,0xAC,0xAD,0x8C,0x8E,0x80,0xB6,	/* ����	    */
	0xB3,0xB5,0xB7,0xB1,0xB0,0xB4,0x76,0xA0,	/* 	        */
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/*        	*/
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40 	/*        	*/
	};

	ebcd=tt[ascii];
	return (ebcd);
}
